# 第二章 实训一  RISC-V下的VIM和GCC练习


## 任务1 熟悉VIM的基本操作

### 前言

VI 编辑器是Linux和Unix上最基本的文本编辑器，工作在字符模式下。由于不需要图形界面，使它成了效率很高的文本编辑器。尽管在Linux上也有很多图形界面的编辑器可用，但VI在系统和服务器管理中的功能是那些图形编辑器所无法比拟的。
VI有3个模式：插入模式、命令模式、低行模式。
插入模式：在此模式下可以输入字符，按ESC将回到命令模式。
命令模式：可以移动光标、删除字符等。
底行模式：可以保存文件、退出vi、设置vi、查找等功能(低行模式也可以看作是命令模式里的)。
VI有模式。通俗地做一下对比。notepad无模式（或称为只有一种编辑模式），你按下j，就是在正文中输入j；要保存，就要ctrl+s；要下移一行，就要↓或鼠标。而在VI中，打开一个文件后，并不处在编辑模式，而是Normal模式，此时你按j，VI并不认为你要在正文中输入j，而是代表光标下移一行。此时按i表示进入insert模式，即编辑模式，即notepad的模式。编辑模式按Esc退回normal模式。normal模式下按:进入命令行模式，用于输入较复杂的命令。比如:w代表保存文件，:e a.txt代表打开文件a.txt。即VI可以不用鼠标、方向键、菜单、Ctrl、alt……发出命令。
VI强大的编辑能力中很大部分是来自于其普通模式命令。vi的设计理念是命令的组合。

### 开始操作

使用“ESC”键在命令模式和插入模式之间进行切换。各项操作命令如下：

1.进入插入模式
a追加，I插入，o在当前行下插入一空行；A在行尾追加，I从行首插入，0在当前行上插入一空行。

2.复制正文
yy复制当前行，nyy复制n行，yw复制一个词，y)复制从光标至句末的所有正文；y}复制从光标至句首的所有正文，nyx复制类型为x。

3.删除正文
x删除一个字符，dd删除当前行，ndd删除n行，dw删除一个单词（从光标处开始），nx删除n个字符，^gndd删除n行正文到缓冲区g中，^Gndd删除n行正文追加到缓冲区g中，c$从当前光标处删至行尾，d^从当前光标处删至行首，ndw（或dnw）删除n个词。

4.替换正文
p将缓冲区的内容粘贴到当前光标处，^gp将g缓冲区里的内容粘贴到当前行下，^gP将g缓冲区的内容粘贴到当前行上，rn用字符n替换当前字符。

5.查找定位
nG将光标定位到第n行，^F向前一屏，^B向后一屏，^D向下半屏，^U向上半屏。

6.文件操作:w写盘，:wq（或:ZZ）写盘退出，:q!不存盘退出，:e!不存盘不退出，u恢复前一步的改变，:e filename编辑文件名，:w filename写文件名，:w! filename重写文件名，:! cmd运行一个命令，然后返回，^G显示当前文件和行号。
练习code\子任务1：vim目录下的vim练习程序。



## 任务2 GCC的基本操作

### 开始操作
示例程序如下：

`
//test.c
#include <stdio.h>
int main(void)
{
    printf("Hello World!\n");
    return 0;
}



这个程序，一步到位的编译指令是:

gcc test.c -o test
`


实质上，上述编译过程是分为四个阶段进行的，即预处理(也称预编译，Preprocessing)、编译(Compilation)、汇编 (Assembly)和连接(Linking)。

1.预处理
`gcc -E test.c -o test.i 或 gcc -E test.c `
 

可以输出test.i文件中存放着test.c经预处理之后的代码。打开test.i文件，看一看，就明白了。后面那条指令，是直接在命令行窗口中输出预处理后的代码.

gcc的-E选项，可以让编译器在预处理后停止，并输出预处理结果。在本例中，预处理结果就是将stdio.h 文件中的内容插入到test.c中了。

2.编译为汇编代码(Compilation)
预处理之后，可直接对生成的test.i文件编译，生成汇编代码：

`gcc -S test.i -o test.s`
gcc的-S选项，表示在程序编译期间，在生成汇编代码后，停止，-o输出汇编代码文件。

3.汇编(Assembly)
对于上一小节中生成的汇编代码文件test.s，gas汇编器负责将其编译为目标文件，如下：

`gcc -c test.s -o test.o`

4.连接(Linking)
gcc连接器是gas提供的，负责将程序的目标文件与所需的所有附加的目标文件连接起来，最终生成可执行文件。附加的目标文件包括静态连接库和动态连接库。

对于上一小节中生成的test.o，将其与Ｃ标准输入输出库进行连接，最终生成程序test

`gcc test.o -o test`